<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>產品損壞回報（QR Code）</title>
<style>
body { font-family: system-ui; background:#f5f5f5; }
.box { max-width:700px; margin:40px auto; background:#fff; padding:20px; border-radius:8px; }
label { display:block; margin-top:12px; }
input, select, textarea, button {
  width:100%; padding:8px; margin-top:4px;
}
button { margin-top:16px; }
</style>
</head>

<body>
<div class="box">
<h2>產品損壞回報（QR Code）</h2>

<label>姓名</label>
<input id="user" placeholder="請輸入姓名">

<label>日期</label>
<input id="date" type="date">

<label>數量</label>
<input id="qty" type="number" value="1" min="1">

<label>產品編號（可手打 / QR 帶入）</label>
<input id="pid" placeholder="MAT-001">

<label>材料是否良好</label>
<select id="status">
  <option value="良好">良好</option>
  <option value="損壞">損壞</option>
</select>

<label>備註（可選）</label>
<textarea id="note" placeholder="例如：刮傷、掉漆、缺件"></textarea>

<label>照片（可選）</label>
<input id="photo" type="file" accept="image/*">

<button onclick="submitForm()">送出</button>
<p id="msg"></p>
</div>

<script>
// ===== 改成你自己的 Apps Script /exec 網址 =====
<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbx6YGANUmrv9EcqRlX8iMr7ZpwVsxgJ64IiCmlCM8eDdx-ijsS8cAjbdD80AV-iQRX-pw/exec";
let photoBase64 = "";

document.getElementById("photo").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => photoBase64 = reader.result;
  reader.readAsDataURL(file);
});

// QR code 帶入 pid
const params = new URLSearchParams(location.search);
if (params.get("pid")) {
  document.getElementById("pid").value = params.get("pid");
}

async function submitForm() {
  document.getElementById("msg").innerText = "送出中...";

  const data = {
    user: user.value,
    date: date.value,
    pid: pid.value,
    qty: qty.value,
    status: status.value,
    note: note.value,
    photoDataUrl: photoBase64
  };

  try {
    const res = await fetch(WEB_APP_URL, {
      method: "POST",
      body: JSON.stringify(data)
    });
    const json = await res.json();
    document.getElementById("msg").innerText =
      json.ok ? "✅ 送出成功" : "❌ 送出失敗：" + json.error;
  } catch (e) {
    document.getElementById("msg").innerText = "❌ 網路錯誤";
  }
}
</script>
</body>
</html>

